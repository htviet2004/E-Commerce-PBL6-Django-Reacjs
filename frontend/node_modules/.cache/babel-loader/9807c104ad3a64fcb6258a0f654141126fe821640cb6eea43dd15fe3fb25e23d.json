{"ast":null,"code":"const BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\nconst TOKEN_KEYS = ['access_token', 'token', 'jwt', 'authToken'];\nfunction getToken() {\n  for (const k of TOKEN_KEYS) {\n    const v = localStorage.getItem(k);\n    if (v) return v;\n  }\n  return null;\n}\nfunction authHeaders() {\n  const token = getToken();\n  return token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n}\nasync function parseOrText(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nexport async function getProductReviews(productId) {\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\n    credentials: 'include',\n    headers: {\n      Accept: 'application/json',\n      ...authHeaders()\n    }\n  });\n  if (!res.ok) throw new Error(`Failed to fetch reviews (${res.status})`);\n  return res.json(); // { reviews, average, count }\n}\nexport async function getReviewEligibility(productId) {\n  const res = await fetch(`${BASE}/products/${productId}/reviews/eligibility/`, {\n    credentials: 'include',\n    headers: {\n      Accept: 'application/json',\n      ...authHeaders()\n    }\n  });\n  if (res.status === 401) {\n    return {\n      can_review: false,\n      reason: 'unauthenticated'\n    };\n  }\n  if (!res.ok) throw new Error(`Failed to check eligibility (${res.status})`);\n  return res.json(); // { can_review, my_review? }\n}\nexport async function submitReview(productId, {\n  rating,\n  comment\n}) {\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\n    method: 'POST',\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n      ...authHeaders()\n    },\n    body: JSON.stringify({\n      rating,\n      comment\n    })\n  });\n  if (!res.ok) {\n    const body = await parseOrText(res);\n    const msg = typeof body === 'string' ? body : body.detail || 'Failed to submit review';\n    throw new Error(`${msg} (${res.status})`);\n  }\n  return res.json();\n}","map":{"version":3,"names":["BASE","process","env","REACT_APP_API_BASE","TOKEN_KEYS","getToken","k","v","localStorage","getItem","authHeaders","token","Authorization","parseOrText","res","text","JSON","parse","getProductReviews","productId","fetch","credentials","headers","Accept","ok","Error","status","json","getReviewEligibility","can_review","reason","submitReview","rating","comment","method","body","stringify","msg","detail"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/reviewsApi.js"],"sourcesContent":["const BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\r\n\r\nconst TOKEN_KEYS = ['access_token', 'token', 'jwt', 'authToken'];\r\nfunction getToken() {\r\n  for (const k of TOKEN_KEYS) {\r\n    const v = localStorage.getItem(k);\r\n    if (v) return v;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction authHeaders() {\r\n  const token = getToken();\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseOrText(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function getProductReviews(productId) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\r\n    credentials: 'include',\r\n    headers: { Accept: 'application/json', ...authHeaders() }\r\n  });\r\n  if (!res.ok) throw new Error(`Failed to fetch reviews (${res.status})`);\r\n  return res.json(); // { reviews, average, count }\r\n}\r\n\r\nexport async function getReviewEligibility(productId) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/eligibility/`, {\r\n    credentials: 'include',\r\n    headers: { Accept: 'application/json', ...authHeaders() }\r\n  });\r\n  if (res.status === 401) {\r\n    return { can_review: false, reason: 'unauthenticated' };\r\n  }\r\n  if (!res.ok) throw new Error(`Failed to check eligibility (${res.status})`);\r\n  return res.json(); // { can_review, my_review? }\r\n}\r\n\r\nexport async function submitReview(productId, { rating, comment }) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\r\n    method: 'POST',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      Accept: 'application/json',\r\n      ...authHeaders()\r\n    },\r\n    body: JSON.stringify({ rating, comment })\r\n  });\r\n  if (!res.ok) {\r\n    const body = await parseOrText(res);\r\n    const msg = typeof body === 'string' ? body : (body.detail || 'Failed to submit review');\r\n    throw new Error(`${msg} (${res.status})`);\r\n  }\r\n  return res.json();\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}