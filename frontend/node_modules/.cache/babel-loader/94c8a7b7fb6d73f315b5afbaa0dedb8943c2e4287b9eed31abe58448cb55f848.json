{"ast":null,"code":"var _process$env$REACT_AP;\nconst API = ((_process$env$REACT_AP = process.env.REACT_APP_API_URL) === null || _process$env$REACT_AP === void 0 ? void 0 : _process$env$REACT_AP.replace(/\\/$/, '')) || 'http://localhost:8000';\nfunction getAuthHeader() {\n  const token = localStorage.getItem('access_token');\n  return token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n}\nasync function parseJson(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nexport async function login(username, password) {\n  var _data$access, _data$tokens, _data$refresh, _data$tokens2, _ref, _data$user;\n  const res = await fetch(`${API}/api/users/token/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n\n  // handle both shapes: { access, refresh }  OR { tokens: { access, refresh }, user }\n  const access = (_data$access = data.access) !== null && _data$access !== void 0 ? _data$access : (_data$tokens = data.tokens) === null || _data$tokens === void 0 ? void 0 : _data$tokens.access;\n  const refresh = (_data$refresh = data.refresh) !== null && _data$refresh !== void 0 ? _data$refresh : (_data$tokens2 = data.tokens) === null || _data$tokens2 === void 0 ? void 0 : _data$tokens2.refresh;\n  if (access) localStorage.setItem('access_token', access);\n  if (refresh) localStorage.setItem('refresh_token', refresh);\n\n  // optionally store user if returned\n  const user = (_ref = (_data$user = data.user) !== null && _data$user !== void 0 ? _data$user : data.user_info) !== null && _ref !== void 0 ? _ref : null;\n  if (user) localStorage.setItem('user', JSON.stringify(user));\n\n  // try to fetch current user if not returned\n  if (!user) {\n    try {\n      const apiUser = await getCurrentUser();\n      if (apiUser) localStorage.setItem('user', JSON.stringify(apiUser));\n      return {\n        access,\n        refresh,\n        user: apiUser\n      };\n    } catch (_) {/* ignore */}\n  }\n  return {\n    access,\n    refresh,\n    user\n  };\n}\nexport async function refreshToken() {\n  var _data$access2, _data$tokens3;\n  const refresh = localStorage.getItem('refresh_token');\n  if (!refresh) throw new Error('No refresh token');\n  const res = await fetch(`${API}/api/users/token/refresh/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      refresh\n    })\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  const newAccess = (_data$access2 = data.access) !== null && _data$access2 !== void 0 ? _data$access2 : (_data$tokens3 = data.tokens) === null || _data$tokens3 === void 0 ? void 0 : _data$tokens3.access;\n  if (newAccess) localStorage.setItem('access_token', newAccess);\n  return data;\n}\nexport async function register(payload) {\n  var _data$access3, _data$tokens4, _data$refresh2, _data$tokens5, _data$user2;\n  const res = await fetch(`${API}/api/auth/register/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  // try to save tokens if backend returns them\n  const access = (_data$access3 = data.access) !== null && _data$access3 !== void 0 ? _data$access3 : (_data$tokens4 = data.tokens) === null || _data$tokens4 === void 0 ? void 0 : _data$tokens4.access;\n  const refresh = (_data$refresh2 = data.refresh) !== null && _data$refresh2 !== void 0 ? _data$refresh2 : (_data$tokens5 = data.tokens) === null || _data$tokens5 === void 0 ? void 0 : _data$tokens5.refresh;\n  if (access) localStorage.setItem('access_token', access);\n  if (refresh) localStorage.setItem('refresh_token', refresh);\n  const user = (_data$user2 = data.user) !== null && _data$user2 !== void 0 ? _data$user2 : null;\n  if (user) localStorage.setItem('user', JSON.stringify(user));\n  return data;\n}\nexport async function logout() {\n  try {\n    await fetch(`${API}/api/auth/logout/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeader()\n      }\n    });\n  } catch (e) {/* ignore */}\n  localStorage.removeItem('access_token');\n  localStorage.removeItem('refresh_token');\n  localStorage.removeItem('user');\n}\nexport async function getCurrentUser() {\n  var _data$user3;\n  const res = await fetch(`${API}/api/users/me/`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      ...getAuthHeader()\n    }\n  });\n  if (res.status === 401 || res.status === 403) {\n    throw new Error('Unauthorized');\n  }\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  return (_data$user3 = data.user) !== null && _data$user3 !== void 0 ? _data$user3 : data;\n}\nexport default {\n  login,\n  register,\n  logout,\n  getCurrentUser,\n  refreshToken\n};","map":{"version":3,"names":["API","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","getAuthHeader","token","localStorage","getItem","Authorization","parseJson","res","text","JSON","parse","login","username","password","_data$access","_data$tokens","_data$refresh","_data$tokens2","_ref","_data$user","fetch","method","headers","body","stringify","data","ok","access","tokens","refresh","setItem","user","user_info","apiUser","getCurrentUser","_","refreshToken","_data$access2","_data$tokens3","Error","newAccess","register","payload","_data$access3","_data$tokens4","_data$refresh2","_data$tokens5","_data$user2","logout","e","removeItem","_data$user3","status"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API = (process.env.REACT_APP_API_URL?.replace(/\\/$/, '') || 'http://localhost:8000');\r\n\r\nfunction getAuthHeader() {\r\n  const token = localStorage.getItem('access_token');\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseJson(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API}/api/users/token/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n\r\n  // handle both shapes: { access, refresh }  OR { tokens: { access, refresh }, user }\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n\r\n  // optionally store user if returned\r\n  const user = data.user ?? data.user_info ?? null;\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n\r\n  // try to fetch current user if not returned\r\n  if (!user) {\r\n    try {\r\n      const apiUser = await getCurrentUser();\r\n      if (apiUser) localStorage.setItem('user', JSON.stringify(apiUser));\r\n      return { access, refresh, user: apiUser };\r\n    } catch (_) { /* ignore */ }\r\n  }\r\n\r\n  return { access, refresh, user };\r\n}\r\n\r\nexport async function refreshToken() {\r\n  const refresh = localStorage.getItem('refresh_token');\r\n  if (!refresh) throw new Error('No refresh token');\r\n  const res = await fetch(`${API}/api/users/token/refresh/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ refresh }),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  const newAccess = data.access ?? data.tokens?.access;\r\n  if (newAccess) localStorage.setItem('access_token', newAccess);\r\n  return data;\r\n}\r\n\r\nexport async function register(payload) {\r\n  const res = await fetch(`${API}/api/auth/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  // try to save tokens if backend returns them\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n  const user = data.user ?? null;\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n  return data;\r\n}\r\n\r\nexport async function logout() {\r\n  try {\r\n    await fetch(`${API}/api/auth/logout/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n    });\r\n  } catch (e) { /* ignore */ }\r\n  localStorage.removeItem('access_token');\r\n  localStorage.removeItem('refresh_token');\r\n  localStorage.removeItem('user');\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const res = await fetch(`${API}/api/users/me/`, {\r\n    method: 'GET',\r\n    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n  });\r\n  if (res.status === 401 || res.status === 403) {\r\n    throw new Error('Unauthorized');\r\n  }\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  return data.user ?? data;\r\n}\r\n\r\nexport default {\r\n  login,\r\n  register,\r\n  logout,\r\n  getCurrentUser,\r\n  refreshToken,\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}